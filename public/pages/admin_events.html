<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Manage Events</title>
    <style>
        /* Navbar Styles */
        .navbar {
            display: flex; justify-content: space-between; align-items: center;
            background-color: #1B263B; padding: 10px 20px; color: white;
            position: fixed; top: 0; width: 100%; z-index: 1000;
        }
        .navbar .nav-links { display: flex; gap: 20px; align-items: center; }
        .navbar .nav-links a { color: white; text-decoration: none; transition: 0.3s; }
        .navbar .nav-links a:hover { color: #4CAF50; }
        .back-btn { background-color: #032fc0; color: white; padding: 8px 16px; border-radius: 5px; border: none; cursor: pointer; }

        /* General body styling */
        body {
            font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; background-size: cover; background-attachment: fixed;
            padding-top: 100px; padding-bottom: 50px;
            background-image: url('https://img.freepik.com/premium-vector/festive-banner-carnival-sign-birthday-party-fun-event_220217-95.jpg');
        }

        .card {
            background-color: #e8e5e5f2; padding: 20px; border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); width: 90%; max-width: 500px; margin-bottom: 30px;
        }

        .manage-card { max-width: 800px; width: 95%; }
        form { display: flex; flex-direction: column; }
        label { margin-bottom: 8px; font-weight: bold; }
        input, textarea { margin-bottom: 16px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { background-color: #105db5; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #031a83; }

        /* Table Styles */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #1B263B; color: white; }
        .remove-btn { background-color: #ff4d4d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="navbar">
        <button id="logoutBtn" class="back-btn">Logout</button>
        <div class="nav-links">
            <a href="admin_events">Events</a>
            <a href="admin_clubs">Clubs</a>
            <a href="registrations_list" style="color: #4CAF50; font-weight: bold;">View Registrations</a>
        </div>
        <div class="logo" style="font-size: 24px; font-weight: bold; color: #ACB0BD; margin-right: 30px;">Connect</div>
    </div>

    <div class="card">
        <h2>Add a New Event</h2>
        <form id="eventForm">
            <label>Title:</label>
            <input type="text" name="title" required>
            <label>Host:</label>
            <input type="text" name="host" required>
            <label>Description:</label>
            <textarea name="desc" required></textarea>
            <label>Date:</label>
            <input type="date" name="date" required>
            <label>Venue:</label>
            <input type="text" name="venue" required>
            <button type="submit">Add Event</button>
        </form>
    </div>

    <div class="card manage-card">
        <h2>Current Events</h2>
        <table>
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="eventList">
                </tbody>
        </table>
    </div>

    <script>
        // Handle Logout
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('jwtToken');
            window.location.href = '/';
        });

        // Load and Render Events
        async function loadEvents() {
            try {
                const response = await fetch('/events'); 
                const events = await response.json();
                const eventList = document.getElementById('eventList');
                
                eventList.innerHTML = events.map(event => `
                    <tr>
                        <td>${event.title}</td>
                        <td>${event.date}</td>
                        <td>
                            <button class="remove-btn" onclick="deleteEvent('${event._id}')">Remove</button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error("Error loading events:", err);
            }
        }

        // Handle Event Deletion
        async function deleteEvent(eventId) {
            if (!confirm("Remove this event?")) return;

            const token = localStorage.getItem('jwtToken');
            const response = await fetch(`/admin/delete_event/${eventId}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if (response.ok) {
                alert("Event removed!");
                loadEvents();
            } else {
                alert("Unauthorized! Verify your Admin role in MongoDB Atlas.");
            }
        }

        // Handle Form Submission
        document.getElementById('eventForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const token = localStorage.getItem('jwtToken');
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            const response = await fetch('/admin_events', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('Event added!');
                this.reset();
                loadEvents();
            }
        });

        window.onload = loadEvents;
    </script>
</body>
</html>